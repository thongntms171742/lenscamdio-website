<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch của tôi - LENSCAMDIO</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <nav class="navbar">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <a href="index.html" class="navbar-brand">
                    <i class="fas fa-camera"></i> LENSCAMDIO        
                </a>
                <div class="navbar-nav d-flex">
                    <a href="index.html" class="nav-link">Trang chủ</a>
                    <a href="studio-booking.html" class="nav-link">Đặt lịch Studio</a>
                    <a href="camera-rental.html" class="nav-link">Thuê máy ảnh</a>
                    <a href="products.html" class="nav-link">Sản phẩm</a>
                    <a href="my-booking.html" class="nav-link active">Lịch của tôi</a>
                    <a href="contact.html" class="nav-link">Liên hệ</a>
                    <a href="cart.html" class="nav-link cart-link">
                        <i class="fas fa-shopping-cart"></i> Giỏ hàng (<span id="cart-count">0</span>)
                    </a>
                    <a href="login.html" class="nav-link login-btn">
                        <i class="fas fa-user"></i> Đăng nhập
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="text-center">
                <h1>Lịch của tôi</h1>
                <p>Quản lý booking studio và thiết bị cho thuê</p>
            </div>
        </div>
    </section>

    <!-- Tab Navigation -->
    <section class="section" style="padding: 2rem 0;">
        <div class="container">
            <div class="text-center mb-4">
                <button class="btn-outline-primary tab-btn active" data-tab="current">Booking hiện tại</button>
                <button class="btn-outline-primary tab-btn" data-tab="history">Lịch sử</button>
            </div>
        </div>
    </section>

    <!-- Current Bookings -->
    <section class="section tab-content" id="current">
        <div class="container">
            <div id="currentBookings">
                <!-- Current bookings will be populated here -->
            </div>
        </div>
    </section>

    <!-- Booking History -->
    <section class="section tab-content" id="history" style="display: none;">
        <div class="container">
            <div id="bookingHistory">
                <!-- Booking history will be populated here -->
            </div>
        </div>
    </section>

    <!-- Empty State -->
    <div id="emptyState" class="text-center" style="display: none; padding: 4rem 0;">
        <i class="fas fa-calendar-alt" style="font-size: 4rem; color: var(--text-light); margin-bottom: 2rem;"></i>
        <h3 style="margin-bottom: 1rem;">Chưa có booking nào</h3>
        <p style="color: var(--text-light); margin-bottom: 2rem;">Hãy đặt lịch studio hoặc thuê thiết bị ngay bây giờ!</p>
        <a href="studio-booking.html" class="btn-primary me-3">Đặt lịch Studio</a>
        <a href="camera-rental.html" class="btn-outline-primary">Thuê máy ảnh</a>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-3 col-sm-6 mb-4">
                    <h5>LENSCAMDIO</h5>
                    <p>Không gian chụp ảnh chuyên nghiệp và dịch vụ cho thuê thiết bị hàng đầu tại Việt Nam.</p>
                    <div class="social-links mt-3">
                        <a href="#" class="social-link"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-youtube"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-tiktok"></i></a>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-4">
                    <h5>Dịch vụ</h5>
                    <ul class="footer-links">
                        <li><a href="studio-booking.html">Thuê Studio</a></li>
                        <li><a href="camera-rental.html">Thuê máy ảnh</a></li>
                        <li><a href="#">Chụp ảnh sự kiện</a></li>
                        <li><a href="#">Quay video</a></li>
                        <li><a href="#">Tư vấn concept</a></li>
                    </ul>
                </div>
                <div class="col-md-3 col-sm-6 mb-4">
                    <h5>Hỗ trợ</h5>
                    <ul class="footer-links">
                        <li><a href="contact.html">Liên hệ</a></li>
                        <li><a href="#">Hướng dẫn đặt lịch</a></li>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Chính sách</a></li>
                        <li><a href="#">Điều khoản</a></li>
                    </ul>
                </div>
                <div class="col-md-3 col-sm-6 mb-4">
                    <h5>Liên hệ</h5>
                    <div class="contact-info">
                        <p><i class="fas fa-map-marker-alt"></i> 123 Đường ABC, Quận 1, TP.HCM</p>
                        <p><i class="fas fa-phone"></i> 0123-456-789</p>
                        <p><i class="fas fa-envelope"></i> info@studioproject.com</p>
                        <p><i class="fas fa-clock"></i> 8:00 - 22:00 (Thứ 2 - Chủ nhật)</p>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <p class="mb-0">&copy; 2024 LENSCAMDIO. Tất cả quyền được bảo lưu.</p>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <p class="mb-0">Thiết kế bởi LENSCAMDIO Team</p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Floating Cart Button -->
    <button class="floating-cart-btn" onclick="window.location.href='cart.html'">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-badge hidden" id="floating-cart-badge">0</span>
    </button>

    <!-- Simple Chat Box -->
    <div id="chatbox-root">
      <div id="chatbox-container">
        <div id="chatbox-header">Trợ lý AI LENSCAMDIO</div>
        <div id="chatbox-messages"></div>
        <div id="chatbox-input-row">
          <input id="chatbox-input" type="text" placeholder="Nhập câu hỏi...">
          <button id="chatbox-send">Gửi</button>
        </div>
      </div>
      <button id="chatbox-toggle" title="Chat với LENSCAMDIO">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M4 19V7a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v8a3 3 0 0 1-3 3H7l-3 4z" fill="currentColor"/>
        </svg>
      </button>
    </div>

    <script src="script.js"></script>
    <script>
        // Sample data for demonstration
        const sampleBookings = [
            {
                id: 1,
                type: 'studio',
                name: 'Studio Modern A',
                date: '2024-01-15',
                time: '14:00',
                duration: '8 giờ',
                price: 1200000,
                status: 'confirmed',
                bookedAt: '2024-01-10T10:30:00Z',
                customerName: 'Nguyễn Văn A',
                customerEmail: 'nguyenvana@email.com',
                customerPhone: '0123456789',
                note: 'Chụp ảnh thời trang'
            },
            {
                id: 2,
                type: 'equipment',
                items: [
                    { name: 'Canon EOS R5', price: 800000, quantity: 1 },
                    { name: 'Canon 85mm f/1.2L', price: 500000, quantity: 1 }
                ],
                rentalDate: '2024-01-20',
                returnDate: '2024-01-22',
                totalPrice: 1300000,
                status: 'pending',
                bookedAt: '2024-01-12T15:20:00Z',
                customerName: 'Trần Thị B',
                customerEmail: 'tranthib@email.com',
                customerPhone: '0987654321',
                address: '123 Đường XYZ, Quận 3, TP.HCM',
                idCard: '123456789012'
            },
            {
                id: 3,
                type: 'studio',
                name: 'Studio Vintage B',
                date: '2024-01-05',
                time: '10:00',
                duration: '6 giờ',
                price: 1200000,
                status: 'completed',
                bookedAt: '2024-01-01T09:00:00Z',
                customerName: 'Lê Văn C',
                customerEmail: 'levanc@email.com',
                customerPhone: '0123987654',
                note: 'Chụp ảnh cưới'
            }
        ];

        // Load orders from localStorage and convert to bookings format
        function loadOrdersAsBookings() {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const orderBookings = orders.map(order => ({
                id: `order-${order.code}`,
                type: 'equipment',
                items: order.items.map(item => ({
                    name: item.name,
                    price: item.price,
                    quantity: item.quantity,
                    image: item.image
                })),
                rentalDate: order.createdAt.split('T')[0],
                returnDate: new Date(new Date(order.createdAt).getTime() + 3*24*60*60*1000).toISOString().split('T')[0], // +3 days
                totalPrice: parseInt(order.total.replace(/[^\d]/g, '')),
                status: order.status,
                bookedAt: order.createdAt,
                customerName: order.customer.name,
                customerEmail: order.customer.email,
                customerPhone: order.customer.phone,
                orderCode: order.code,
                paymentMethod: order.paymentMethod,
                note: order.customer.note
            }));
            
            return orderBookings;
        }

        // Initialize bookings from localStorage or use sample data
        let bookings = [...loadOrdersAsBookings(), ...sampleBookings];
        
        // Save combined bookings back to localStorage
        localStorage.setItem('bookings', JSON.stringify(bookings));

        // Tab functionality
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const tab = this.getAttribute('data-tab');
                
                // Update active button
                tabBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // Show/hide content
                tabContents.forEach(content => {
                    content.style.display = content.id === tab ? 'block' : 'none';
                });
            });
        });

        // Status badge colors
        function getStatusBadge(status) {
            const badges = {
                'pending': '<span class="badge badge-warning">Chờ xác nhận</span>',
                'confirmed': '<span class="badge badge-success">Đã xác nhận</span>',
                'completed': '<span class="badge badge-info">Hoàn thành</span>',
                'cancelled': '<span class="badge badge-danger">Đã hủy</span>'
            };
            return badges[status] || '<span class="badge badge-secondary">Không xác định</span>';
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('vi-VN', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Create booking card
        function createBookingCard(booking) {
            const card = document.createElement('div');
            card.className = 'card mb-4';
            
            if (booking.type === 'studio') {
                card.innerHTML = `
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h5 class="card-title">${booking.name}</h5>
                                <p class="card-text"><i class="fas fa-calendar-alt"></i> ${formatDate(booking.date)} lúc ${booking.time}</p>
                                <p class="card-text"><i class="fas fa-clock"></i> Thời gian: ${booking.duration}</p>
                            </div>
                            <div class="text-end">
                                ${getStatusBadge(booking.status)}
                                <div class="price mt-2">${booking.price.toLocaleString('vi-VN')}đ</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Khách hàng:</strong> ${booking.customerName}</p>
                                <p><strong>Email:</strong> ${booking.customerEmail}</p>
                                <p><strong>Điện thoại:</strong> ${booking.customerPhone}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Đặt lúc:</strong> ${new Date(booking.bookedAt).toLocaleString('vi-VN')}</p>
                                ${booking.note ? `<p><strong>Ghi chú:</strong> ${booking.note}</p>` : ''}
                            </div>
                        </div>
                        ${booking.status === 'pending' ? `
                            <div class="mt-3">
                                <button class="btn-outline-primary cancel-btn" data-booking-id="${booking.id}">Hủy booking</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            } else {
                const itemsList = booking.items.map(item => 
                    `<li>${item.name} x${item.quantity} - ${item.price.toLocaleString('vi-VN')}đ</li>`
                ).join('');
                
                card.innerHTML = `
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h5 class="card-title">Thuê thiết bị</h5>
                                <p class="card-text"><i class="fas fa-calendar-alt"></i> ${formatDate(booking.rentalDate)} - ${formatDate(booking.returnDate)}</p>
                                <div class="mb-2">
                                    <strong>Thiết bị:</strong>
                                    <ul style="margin-top: 0.5rem;">
                                        ${itemsList}
                                    </ul>
                                </div>
                            </div>
                            <div class="text-end">
                                ${getStatusBadge(booking.status)}
                                <div class="price mt-2">${booking.totalPrice.toLocaleString('vi-VN')}đ</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Khách hàng:</strong> ${booking.customerName}</p>
                                <p><strong>Email:</strong> ${booking.customerEmail}</p>
                                <p><strong>Điện thoại:</strong> ${booking.customerPhone}</p>
                            </div>
                            <div class="col-md-6">
                                ${booking.address ? `<p><strong>Địa chỉ:</strong> ${booking.address}</p>` : ''}
                                ${booking.idCard ? `<p><strong>CMND/CCCD:</strong> ${booking.idCard}</p>` : ''}
                                ${booking.orderCode ? `<p><strong>Mã đơn hàng:</strong> <code>${booking.orderCode}</code></p>` : ''}
                                ${booking.paymentMethod ? `<p><strong>Thanh toán:</strong> ${booking.paymentMethod}</p>` : ''}
                                <p><strong>Đặt lúc:</strong> ${new Date(booking.bookedAt).toLocaleString('vi-VN')}</p>
                            </div>
                        </div>
                        ${booking.status === 'pending' ? `
                            <div class="mt-3">
                                <button class="btn-outline-primary cancel-btn" data-booking-id="${booking.id}">Hủy booking</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            return card;
        }

        // Display bookings
        function displayBookings() {
            const currentBookings = document.getElementById('currentBookings');
            const bookingHistory = document.getElementById('bookingHistory');
            const emptyState = document.getElementById('emptyState');
            
            const current = bookings.filter(b => b.status === 'pending' || b.status === 'confirmed');
            const history = bookings.filter(b => b.status === 'completed' || b.status === 'cancelled');
            
            // Clear existing content
            currentBookings.innerHTML = '';
            bookingHistory.innerHTML = '';
            
            // Display current bookings
            if (current.length > 0) {
                current.forEach(booking => {
                    currentBookings.appendChild(createBookingCard(booking));
                });
                emptyState.style.display = 'none';
            } else {
                currentBookings.innerHTML = '<div class="text-center" style="padding: 2rem 0;"><p>Không có booking hiện tại</p></div>';
            }
            
            // Display booking history
            if (history.length > 0) {
                history.forEach(booking => {
                    bookingHistory.appendChild(createBookingCard(booking));
                });
            } else {
                bookingHistory.innerHTML = '<div class="text-center" style="padding: 2rem 0;"><p>Chưa có lịch sử booking</p></div>';
            }
            
            // Show empty state if no bookings at all
            if (bookings.length === 0) {
                emptyState.style.display = 'block';
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.style.display = 'none';
                });
            }
        }

        // Cancel booking
        function cancelBooking(bookingId) {
            if (confirm('Bạn có chắc chắn muốn hủy booking này?')) {
                const booking = bookings.find(b => b.id === bookingId);
                if (booking) {
                    booking.status = 'cancelled';
                    localStorage.setItem('bookings', JSON.stringify(bookings));
                    displayBookings();
                    showNotification('Đã hủy booking thành công!', 'success');
                }
            }
        }

        // Event listeners
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('cancel-btn')) {
                const bookingId = parseInt(e.target.getAttribute('data-booking-id'));
                cancelBooking(bookingId);
            }
        });

        // Initialize
        displayBookings();
    </script>
    
    <style>
        .tab-btn {
            margin: 0 0.5rem 0.5rem 0;
            padding: 0.5rem 1rem;
            border: 2px solid var(--primary-color);
            background: transparent;
            color: var(--primary-color);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab-btn:hover,
        .tab-btn.active {
            background: var(--primary-color);
            color: white;
        }
        
        .badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .badge-warning {
            background: #f59e0b;
            color: white;
        }
        
        .badge-success {
            background: #10b981;
            color: white;
        }
        
        .badge-info {
            background: #3b82f6;
            color: white;
        }
        
        .badge-danger {
            background: #ef4444;
            color: white;
        }
        
        .badge-secondary {
            background: #6b7280;
            color: white;
        }
        
        .cancel-btn {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
        
        .me-3 {
            margin-right: 1rem;
        }
        
        @media (max-width: 768px) {
            .d-flex {
                flex-direction: column;
            }
            
            .text-end {
                text-align: left;
                margin-top: 1rem;
            }
        }
    </style>
</body>
</html> 